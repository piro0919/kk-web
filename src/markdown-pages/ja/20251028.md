---
slug: "/blog/20251028"
date: "2025-10-28"
title: "VercelのPreview環境でVercel AuthenticationをかけたままStripeのWebhookを通す"
---

ChatGPT に聞きつつ実装したら大嘘ばかりつかれて痛い目にあったので、備忘録がてら。

---

## 手順

以下のとおりです。

1. Vercel Authentication をオンにする
2. Protection Bypass for Automation に VERCEL_AUTOMATION_BYPASS_SECRET を設定する
3. Stripe の Webhook に送信先を追加する

全然難しくないかなと、Vercel の Free プランでも設定できるんですかね？

## 手順詳細

### Vercel Authentication をオンにする

Settings → Deployment Protection に Vercel Authentication が存在するので、オンにします。

### Protection Bypass for Automation に VERCEL_AUTOMATION_BYPASS_SECRET を設定する

同画面で、Protection Bypass for Automation という項目があるので、適当な 32 桁の文字列を設定します。

設定し終わった後 Regenerate も可能です。

あと設定後に値も見ることができるので、メモも不要です。

### Stripe の Webhook に送信先を追加する

エンドポイント URL の形式のイメージは以下のとおりです。

<https://staging.hogefuga.com/api/stripe/webhook?x-vercel-protection-bypass=設定した32桁の文字列>

ChatGPT に聞くとここらへんで大嘘をつかれました、いい加減にしろ。

---

ちなみに [stack overflow](https://stackoverflow.com/questions/77834431/how-to-configure-webhooks-to-work-with-previews-on-vercel) でも言及されていました、ﾀｽｶﾙﾀｽｶﾙ。

そんな感じです。
